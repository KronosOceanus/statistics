[TOC]

# 非参数估计

* 当概率密度很复杂的时候，很难选择合适的参数模型，所以直接从现有数据（已知样本分类），选择不同的核函数拟合得到概率密度函数

## 基本思想

* 假设 $R$ 是包含样本点 $x$ 的一个区域，体积为 $V$，有 $n$ 个样本，$k$ 个在 $R$ 中，则概率密度函数：$P(x) = \frac{k}{nV}$（$R$ 区域内平均，数据变平滑）
* 精确度，取决于 $V$ 的选取

## V 的选取方法

### Parzen 窗法（超立方体）

* 模型：区域 $R$ 内，以 $x$ 为中心点，边长为 $h$ 的超立方体 $V = h^d$，落入 $R$ 的样本数量 $k=\sum_{i=1}^nW(\frac{x-x_i}{h})$
* 其中 $W$ 为判定是否落入区域 $R$ 的函数：$W = \begin{cases}1 &dist|x_i|\leq\frac{1}{2} \\ 0 & other\end{cases}$（1 为落入，$dist$ 为距离函数）

#### 核平滑

* 新的想法：$dist|x_i|$ 越小，对概率密度估计的贡献越大
* 概率密度函数：$P_{KDE}(x)=\frac{1}{nh^d}\sum_{i=1}^nK(\frac{x-x_i}{h})$
* 核函数 $K(x)$ 满足：$K(x) \geq 0$ 且 $\int_XK(x)dx=1$
* 通常选取高斯核：$K(x) = \frac{1}{(2\pi h^2)^\frac{d}{2}}e^{-\frac{x^Tx}{2h^2}}$（其中 $h$ 为带宽/是一个对角矩阵/自由选择）

##### Silverman 带宽选择器

* $h=diag(h_1,...,h_d)$
* $d_i = (\frac{4}{(d+2)n})^{\frac{1}{d+4}}\sigma_i$（其中 $\sigma_i$ 是超参数，可以自由选择）

### 最近邻密度估计（超球）

##### n 维球的体积和表面积

* 一维：$\int_{-\infty}^{+\infty}e^{-t^2}dt=\sqrt{\pi}$

* 高斯积分：$G(n) = \int_{-\infty}^{+\infty}...\int_{-\infty}^{+\infty}e^{-x_1^2...-x_n^2dx_1...dx_n}=\pi^{\frac{n}{2}}$

* 曲面 $S_n(r)$ 极径 $r$ 积分：$G(n)=\int_0^{+\infty}dr\int_{S_n(r)}e^{-r^2}dS_n=\int_0^{+\infty}e^{-r^2}S_n(r) dr$
* 球体积与单位球的关系：$V_n(r) = V_n(1)r^n$
* 体积对 $r$ 求导为表面积：$S_n(r) = nV_n(1)r^{n-1}$
* 将 $S_n(r)$ 带入积分：$G(n) = nV_n(1)\int_0^{+\infty}r^{n-1}e^{-r^2}dr$
* 换元 $z = r^2$：$G(n)=\frac{1}{2} nV_n(1)\int_0^{+\infty}z^{\frac{n}{2}-1}e^{-z}dz=\frac{1}{2}nV_n(1)F(\frac{n}{2})$（$Gamma$ 函数）
* 利用高斯积分得：$V_n(r)=\frac{\pi^{\frac{n}{2}}}{F(\frac{n}{2}+1)}r^n$，$S_n(r) = \frac{2\pi^{\frac{n}{2}}}{F(\frac{n}{2})}r^{n-1}$

#### 最近邻距离

* 模型：区域 $R$ 内，以 $x$ 为中心点，半径为 $r$ （距离/自由选择）的超球面区域 $R$ 的体积 $V=\frac{\pi^{\frac{d}{2}}}{F(\frac{d}{2}+1)}r^d$
* 概率密度函数：$P_{KNN}(x)=\frac{k}{nV}=\frac{kF(\frac{d}{2}+1)}{n\pi^{\frac{d}{2}}r^d}$

#### K- 近邻分类器

* 模型：将一个体积为 $V$ 的区域放到待识别样本点 $x$ 周围，包含 $k$ （自由选择）个训练样本点，其中 $k_i$ 个属于 $y_i$ 类，总共 $c$ 类，总的训练样本数为 $n$ 
* 估计每个类别的类条件概率密度（相当于求距离）：$P_n(x_,y_i)=\frac{k_i}{nV}$（$y_i$ 代表类别）
* 属于某类的概率：$P(y_i|x) = \frac{P_n(x,y_i)}{P_n(x)}=\frac{P_n(x,y_i)}{\sum_{j=1}^cP_n(x,y_j)}=\frac{k_i}{k}$
* 分类，即求 $argmax [P(y_i|x)]=argmax(k_i)$

##### 常用距离函数（d 维向量距离）

* 欧几里得距离：$D(x,y)=[(x-y)^T(x-y)]^{\frac{1}{2}}=[\sum_{i=1}^d(x_i-y_i)^2]^{\frac{1}{2}}$
* 街市距离：$D(x,y)=\sum_{i=1}^d|x_i-y_i|$
* 明氏距离：$D(x,y)=[\sum_{i=1}^d|x_i-y_i|^m]^{\frac{1}{m}}$
* 马氏距离（$x,y$ 权重不同）：$D(x,y)=(x-y)^T\sum^{-1}(x-y)$
* 角度相似函数：$D(x,y)=\frac{x^Ty}{||x||_2||y||_2}$（$||.||_2$ 表示 2 范数）
* 海明距离（计数用）：$X=(x_1,...,x_d)^T，Y=(y_1,...,y_d)^T，x_i,y_i\in\{0,1\}$，$D(x,y)$ 为 $x,y$ 中使得不等式 $x_i != y_i$ 成立的 $i$ 的个数

###### 2 范数（补充）

* 矩阵的 2 范数，即矩阵的最大奇异值

